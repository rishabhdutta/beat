<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Scenarios &#8212; beat 1.0beta documentation</title>
    <link rel="stylesheet" href="_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API Reference" href="api.html" />
    <link rel="prev" title="Getting started with BEAT" href="getting_started.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Slab">
    
    
    <script type="text/javascript" src="_static/jquery.gifplayer.js"></script>
    <link rel="stylesheet" type="text/css" href="_static/gifplayer.css">
    <!-- Piwik -->
    <script type="text/javascript">
      var _paq = _paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//pyrocko.org/pwk/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <noscript>
    <img src="https://pyrocko.org/pwk/piwik.php?idsite=1&rec=1" style="border:0" alt="" />
    </noscript>

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
        <ul>
          <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
          <li>
            <img src='https://pyrocko.org/_static/pyrocko.svg' class='pyrocko-button' onclick="window.location = 'https://pyrocko.org';">
          </li>
           &#187;
          <li>
              <a href="index.html">beat 1.0beta documentation</a> &#187;
          </li> 
        </ul>
    </div>
    

  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="scenarios">
<h1>Scenarios<a class="headerlink" href="#scenarios" title="Permalink to this headline">¶</a></h1>
<p>The example scenarios are located in the directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">examples</span>
</pre></div>
</div>
<p>In the following tutorials we will use synthetic example data to get familiar with the basic functionality of BEAT.</p>
<div class="section" id="regional-full-moment-tensor">
<h2>Regional Full Moment Tensor<a class="headerlink" href="#regional-full-moment-tensor" title="Permalink to this headline">¶</a></h2>
<div class="section" id="clone-project">
<h3>Clone project<a class="headerlink" href="#clone-project" title="Permalink to this headline">¶</a></h3>
<p>This setup is comprised of 20 seismic stations that are randomly distributed within distances of 40 to 1000 km compared to a reference event.
To copy the scenario (including the data) to a directory outside of the package source directory, please edit the ‘model path’ (referred to as $beat_models now on) and execute:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">beat</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span>
<span class="n">beat</span> <span class="n">clone</span> <span class="n">FullMT</span> <span class="o">/</span><span class="s1">&#39;model path&#39;</span><span class="o">/</span><span class="n">FullMT</span> <span class="o">--</span><span class="n">copy_data</span>
</pre></div>
</div>
<p>This will create a BEAT project directory named ‘FullMT’ with a configuration file (config_geometry.yaml) and some synthetic example data (seismic_data.pkl).
This directory is going to be referred to as ‘$project_directory’ in the following.</p>
</div>
<div class="section" id="calculate-greens-functions">
<h3>Calculate Greens Functions<a class="headerlink" href="#calculate-greens-functions" title="Permalink to this headline">¶</a></h3>
<p>The station-event geometry determines the grid of Greens Functions (GFs) that will need to be calculated next.</p>
<p>Please open $project_directory/config_geometry.yaml with any text editor (e.g. vi) and check the line 144: store_superdir. Here is written for now /home/vasyurhm/BEATS/GF, which is an example path to the directory of Greens Functions.
This path needs to be replaced with the path to where the GFs are supposed to be stored on your computer. This directory is refered to as the $GF_path in the rest of the text. It is strongly recommended to use a seperate directory apart from the beat source directory and the $project_directory as the GF databases can become very large, depending on the problem! For real examples, the GF databases may require up to several Gigabyte of free disc space. For our example the database that we are going to create is only around 30 Megabyte.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cd $beat_models
beat build_gfs FullMT --datatypes=&#39;seismic&#39;
</pre></div>
</div>
<p>This will create an empty Greens Function store named AqabaMT_ak135_1.000Hz_0 in the $GF_path. Under $GF_path/AqabaMT_ak135_1.000Hz_0/config it is recommended to cross-check again the velocity model and the specifications of the store (open with any texteditor).
Dependend on the case study there are crucial parameters that often need to be changed from the default values: the spatial grid dimensions, the sample rate and the wave phases (body waves and/or surface waves) to be calculated.</p>
<p>In the $project_path/config_geometry.yaml under seismic config we find the gf_config, which holds the major parameters for GF calculation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>gf_config: !beat.SeismicGFConfig
  store_superdir: /home/vasyurhm/BEATS/GF/
  reference_model_idx: 0
  n_variations: [0, 1]
  error_depth: 0.1
  error_velocities: 0.1
  depth_limit_variation: 600.0
  earth_model_name: ak135-f-average.m
  use_crust2: false
  replace_water: false
  custom_velocity_model: |2
        0.             5.51           3.1            2.6         1264.           600.
        7.2            5.51           3.1            2.6         1264.           600.
        7.2            6.23           3.6            2.8         1283.           600.
       21.64           6.23           3.6            2.8         1283.           600.
    mantle
       21.64           7.95           4.45           3.2         1449.           600.
  source_depth_min: 8.0
  source_depth_max: 8.0
  source_depth_spacing: 1.0
  source_distance_radius: 1000.0
  source_distance_spacing: 1.0
  nworkers: 4
  reference_location: !beat.heart.ReferenceLocation
    lat: 29.07
    lon: 34.73
    elevation: 0.0
    depth: 0.0
    station: AqabaMT
  code: qseis
  sample_rate: 1.0
  rm_gfs: true
</pre></div>
</div>
<p>Here we see that instead of the global velocity model ak135 a custom velocity model is going to be used for all the stations.
Below are the grid definitions of the GFs. In this example the source depth grid is limited to one depth (8 km) to reduce calculation time.
As we have stations up to a distance of 970km distance to the event, the distance grid is accordingly extending up to 1000km.
These grid sampling parameters as well as the sample rate are of major importance for the overall optimization. How to adjust these parameters
according to other case studies is described <a class="reference external" href="https://pyrocko.org/docs/current/apps/fomosto/tutorial.html#considerations-for-real-world-applications">here</a>.</p>
<p>The ‘nworkers’ variable defines the number of CPUs to use in parallel for the GF calculations. As these calculations may become very expensive and time-consuming it is of advantage to use as many CPUs as available. To be still able to navigate in your Operating System without crashing the system it is good to leave one CPU work-less. Please edit the ‘nworkers’ parameter now!</p>
<p>For our use-case the grid specifications are fine for now.</p>
<p>The seismic phases for which the GFs are going to be calculated are defined under ‘waveforms’ in the $project_directory/config_geometry.yaml there are</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>- !beat.WaveformFitConfig
  include: true
  name: any_P
  channels: [Z]
  filterer: !beat.heart.Filter
    lower_corner: 0.01
    upper_corner: 0.1
    order: 3
  distances: [0.0, 9.0]
  interpolation: multilinear
  arrival_taper: !beat.heart.ArrivalTaper
    a: -20.0
    b: -10.0
    c: 250.0
    d: 270.0
</pre></div>
</div>
<p>In this case the GFs are going to be calculated for the P body waves. We can add additional WaveformFitConfig(s) if we want to include more phases. Like in our case of a regional setup we would like to include surface waves. For the build_GFs command only the existence of the WaveformFitConfig and the name are of importance and we can ignore the other parameters so far. So lets add to the $project_directory/config_geometry.yaml file, the following config. Please copy ..</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>- !beat.WaveformFitConfig
  include: true
  name: slowest
  channels: [Z]
  filterer: !beat.heart.Filter
    lower_corner: 0.001
    upper_corner: 0.1
    order: 4
  distances: [30.0, 90.0]
  interpolation: multilinear
  arrival_taper: !beat.heart.ArrivalTaper
    a: -15.0
    b: -10.0
    c: 50.0
    d: 55.0
</pre></div>
</div>
<p>and paste it below the ‘any_P’ WaveformFitConfig. Note: You should be having 2 WaveformFitConfig entries and both entries MUST have the same indentation!
Your seismic_config within the $project_directory/config_geometry.yaml should look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>seismic_config: !beat.SeismicConfig
  datadir: ./
  blacklist: []
  calc_data_cov: true
  pre_stack_cut: true
  waveforms:
  - !beat.WaveformFitConfig
    include: true
    name: any_P
    channels: [Z]
    filterer: !beat.heart.Filter
      lower_corner: 0.01
      upper_corner: 0.1
      order: 3
    distances: [0.0, 9.0]
    interpolation: multilinear
    arrival_taper: !beat.heart.ArrivalTaper
      a: -20.0
      b: -10.0
      c: 250.0
      d: 270.0
  - !beat.WaveformFitConfig
    include: true
    name: slowest
    channels: [Z]
    filterer: !beat.heart.Filter
      lower_corner: 0.001
      upper_corner: 0.1
      order: 4
    distances: [30.0, 90.0]
    interpolation: multilinear
    arrival_taper: !beat.heart.ArrivalTaper
      a: -15.0
      b: -10.0
      c: 50.0
      d: 55.0
</pre></div>
</div>
<p>Now the store configuration files have to be updated. As we created them before we need to overwrite them! We can do this with the –force option.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">build_gfs</span> <span class="n">FullMT</span> <span class="o">--</span><span class="n">datatypes</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span> <span class="o">--</span><span class="n">force</span>
</pre></div>
</div>
<p>Checking again the store config under $GF_path/AqabaMT_ak135_1.000Hz_0/config shows the phases that are going to be calculated:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>tabulated_phases:
- !pf.TPDef
  id: any_P
  definition: p,P,p\,P\
- !pf.TPDef
  id: slowest
  definition: &#39;0.8&#39;
</pre></div>
</div>
<p>Finally, we are good to start the GF calculations!:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">build_gfs</span> <span class="n">FullMT</span> <span class="o">--</span><span class="n">datatypes</span><span class="o">=</span><span class="s1">&#39;seismic&#39;</span> <span class="o">--</span><span class="n">force</span> <span class="o">--</span><span class="n">execute</span>
</pre></div>
</div>
<p>Depending on the number of CPUs that have been assigned to the job this may take few minutes.</p>
<p>Next we can use the ‘fomosto’ tool together with ‘snuffler’ to inspect if the GFs look reasonable. To plot the 10 elementary GF components in a depth of 8km at a distance of 500km:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>fomosto view $GF_path/AqabaMT_ak135_1.000Hz_0 --extract=&#39;8k,500k&#39;
</pre></div>
</div>
<p>This looks reasonably well!</p>
<blockquote>
<div><img alt="_images/fomosto_traces_snuffler.png" src="_images/fomosto_traces_snuffler.png" />
</div></blockquote>
</div>
<div class="section" id="sample-the-solution-space">
<h3>Sample the solution space<a class="headerlink" href="#sample-the-solution-space" title="Permalink to this headline">¶</a></h3>
<p>Once we are confident that the GFs are reasonable we may continue to define the optimization specific setup variables.
First of all we check again the WaveformFitConfig for the waves we want to optimize.
In this case we want to optimize the whole waveform from P until the end of the surface waves.
As the wavetrains are very close in the very near field we do not want to have overlapping time windows, which is why we deactivate one of the WaveformFitConfigs, by setting
include=False on the <cite>slowest</cite> WaveformfitConfig. So please open again $project_directory/config_geometry.yaml (if you did close the file again) and edit the respective parameter!</p>
<p>Also there we may define a distance range of stations taken into account,
define a bandpass filter and a time window with respect to the arrival time of the respective wave.
Therefore, stations that are used to optimize the P-wave do not necessarily need to be used to optimize the surface waves by defining different distance ranges.
Similarly, different filters and arrival time windows maybe defined as well. These parameters are all fine for this case here!</p>
<p>The optimization is done in the R, T, Z rotated coordinate system to better tune, which part of the waves are optimized. That is particularly important if the S-wave
is going to be used, as one would typically use only SH waves which are the S-waves in the T-component.
For P-waves one would like to use the Z(vertical) component and for surface waves both components.
So please make sure that in $project_directory/config_geometry.yaml under the WaveformFitConfig (name ‘any_P’) the channels list contains [Z, T] (including the brackets!)!</p>
<p>Finally, we fix the depth prior to 8km (upper and lower) as we only calculated GFs for that depth. $project_directory/config_geometry.yaml under the point ‘priors’:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>priors:
  depth: !beat.heart.Parameter
    name: depth
    form: Uniform
    lower: [8.0]
    upper: [8.0]
    testvalue: [8.0]
</pre></div>
</div>
<p>Of course, in a real case this would not be fixed.
Also we may inspect the data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">check</span> <span class="n">FullMT</span> <span class="o">--</span><span class="n">what</span><span class="o">=</span><span class="s1">&#39;traces&#39;</span>
</pre></div>
</div>
<p>This should open again the ‘snuffler’ window and you can interactively scroll through the traces zoom in and out, filter the traces and much more.
A detailed tutorial about handeling the browser is given <a class="reference external" href="https://pyrocko.org/docs/current/apps/snuffler/tutorial.html">here</a>.</p>
<blockquote>
<div><img alt="_images/FullMT_data.png" src="_images/FullMT_data.png" />
</div></blockquote>
<p>For example you can also right click in the window and see a menu that pops up. There you can select sort the traces by distance or azimuth to get a better picture of the setup.
Now that we checked the optimization setup we are good to go.</p>
<p>Firstly, we fix the source parameters to some random value and only optimize for the hyperparameters (HPs).
How many different random source parameters are choosen and the sampling repeated is determined by the hyper_sampler_config parameters ‘n_stages’ (default:5)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">sample</span> <span class="n">FullMT</span> <span class="o">--</span><span class="n">hypers</span>
</pre></div>
</div>
<p>This reduces the initial search space from 40 orders of magnitude to usually 5 to 10 orders. Checking the $project_directory/config_geometry.yaml,
the HPs parameter bounds show something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>hyperparameters:
  h_any_P_T: !beat.heart.Parameter
    name: h_any_P_T
    form: Uniform
    lower: [-4.0]
    upper: [5.0]
    testvalue: [0.5]
  h_any_P_Z: !beat.heart.Parameter
    name: h_any_P_Z
    form: Uniform
    lower: [-4.0]
    upper: [5.0]
    testvalue: [0.5]
</pre></div>
</div>
<p>At this point the bounds could be relaxed again as well by manually editing the configuration file, or the step could be entirely skipped.
Now that we have an initial guess on the hyperparameters we can run the optimization using the default sampling algorithm, a Sequential Monte Carlo sampler.
The sampler can effectively exploit the parallel architecture of nowadays computers. The ‘n_jobs’ number should be set to as many CPUs as possible in the configuration file.
Note: ‘n_chains’ divided by ‘n_jobs’ MUST yield a whole number! An error is going to be thrown if this is not the case!:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>sampler_config: !beat.SamplerConfig
  name: SMC
  progressbar: true
  parameters: !beat.SMCConfig
    n_chains: 500
    n_steps: 100
    n_jobs: 1
    tune_interval: 10
    coef_variation: 1.0
    stage: 0
    proposal_dist: MultivariateNormal
    check_bnd: true
    update_covariances: false
    rm_flag: true
</pre></div>
</div>
<p>Dependend on the hardware, sampler specifications and number of jobs that have been defined, this calculation is going to take few hours.
Therefore, in order to avoid crashes or in the case of remote connection via ssh it is very much recommended to use something like ‘screen’
to detach the terminal where the process is running. For now we do not do that, simply run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">sample</span> <span class="n">FullMT</span>
</pre></div>
</div>
<p>The sampling is successfully finished if the screen shows something like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>...
backend      - INFO     Loading multitrace from /home/vasyurhm/BEATS/FullMT/geometry/stage_25
smc          - INFO     Beta &gt; 1.: 1.293753
smc          - INFO     Sample final stage
smc          - INFO     Initialising 400 chain traces ...
smc          - INFO     Sampling ...
paripool     - INFO     Worker timeout after 12 second(s)
paripool     - INFO     Overseer timeout after 400 second(s)
paripool     - INFO     Chunksize: 4
paripool     - INFO     Feierabend! Done with the work!
backend      - INFO     Loading multitrace from /home/vasyurhm/BEATS/FullMT2/geometry/stage_-1
smc          - INFO     Finished sampling!
</pre></div>
</div>
</div>
<div class="section" id="restarting-sampling">
<h3>Restarting sampling<a class="headerlink" href="#restarting-sampling" title="Permalink to this headline">¶</a></h3>
<p>For one or the other reason it may happen that sampling crashes and you will want to restart at the point where it crashed.
Otherwise all the sampling that has been done before would be lost. First you have to find out in which ‘stage’ of the sampling the
algorithm crashed. You can do this in two ways. Either by checking the output to the screen of the terminal where you did run the job.
If that is not available anymore check the last lines of the $project_directory/BEAT_log.txt. Open it in any texteditor and go to the end of the file.
There might be written for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span> <span class="mi">20</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span><span class="mi">749</span> <span class="o">-</span> <span class="n">backend</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Loading</span> <span class="n">multitrace</span> <span class="kn">from</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vasyurhm</span><span class="o">/</span><span class="n">BEATS</span><span class="o">/</span><span class="n">FullMT</span><span class="o">/</span><span class="n">geometry</span><span class="o">/</span><span class="n">stage_19</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span> <span class="mi">20</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="mi">035</span> <span class="o">-</span> <span class="n">smc</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Beta</span><span class="p">:</span> <span class="mf">0.117085</span> <span class="n">Stage</span><span class="p">:</span> <span class="mi">20</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span> <span class="mi">20</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="mi">035</span> <span class="o">-</span> <span class="n">smc</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Initialising</span> <span class="mi">400</span> <span class="n">chain</span> <span class="n">traces</span> <span class="o">...</span>
<span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">09</span> <span class="mi">20</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span><span class="mi">355</span> <span class="o">-</span> <span class="n">smc</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Sampling</span> <span class="o">...</span>
</pre></div>
</div>
<p>This means that the algorithm crashed in ‘stage’ 20. To restart from this stage please open $project_directory/config_geometry.yaml and got to
the ‘sampler_config’. There under ‘parameters’ must be a parameter ‘stage’. At this point if the algorithm has been started from the beginning there should be
‘0’. So here we put now 20 as we want to restart in stage 20. As we want to keep all the previous sampling results of that stage, we have to make sure that again under
‘parameters’ the flag ‘rm_flag’ shows ‘false’! If ‘true’, all the previous sampling results will be deleted in the course of new sampling.
Now that we redefined the starting point of the sampling algorithm we are good to start the sampling again.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">sample</span> <span class="n">FullMT</span>
</pre></div>
</div>
</div>
<div class="section" id="summarize-the-results">
<h3>Summarize the results<a class="headerlink" href="#summarize-the-results" title="Permalink to this headline">¶</a></h3>
<p>The following command will create a summary with the statistics of the posterior distribution expressed in quantiles.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">summarize</span> <span class="n">FullMT</span>
</pre></div>
</div>
<p>If you check the summary.txt file (path then also printed to the screen):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>vi $project_directory/geometry/summary.txt
</pre></div>
</div>
<p>For example for the ‘north_shift’ the true value is 20. The posterior pdf quantiles show:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">north_shift</span><span class="p">:</span>

  <span class="n">Mean</span>             <span class="n">SD</span>               <span class="n">MC</span> <span class="n">Error</span>         <span class="mi">95</span><span class="o">%</span> <span class="n">HPD</span> <span class="n">interval</span>
  <span class="o">-------------------------------------------------------------------</span>

  <span class="mf">19.989</span>           <span class="mf">0.010</span>            <span class="mf">0.000</span>            <span class="p">[</span><span class="mf">19.972</span><span class="p">,</span> <span class="mf">20.012</span><span class="p">]</span>

  <span class="n">Posterior</span> <span class="n">quantiles</span><span class="p">:</span>
  <span class="mf">2.5</span>            <span class="mi">25</span>             <span class="mi">50</span>             <span class="mi">75</span>             <span class="mf">97.5</span>
  <span class="o">|--------------|==============|==============|--------------|</span>

  <span class="mf">19.969</span>         <span class="mf">19.982</span>         <span class="mf">19.990</span>         <span class="mf">19.996</span>         <span class="mf">20.010</span>
</pre></div>
</div>
<p>As this is a synthetic case with only little noise it is not particularly surprising to get such a steeply peaked distribution.</p>
</div>
<div class="section" id="plotting">
<h3>Plotting<a class="headerlink" href="#plotting" title="Permalink to this headline">¶</a></h3>
<p>Now to the point that you all have been waiting for ;) the result in pictures.
To see the waveform fit of the posterior maximum likelihood solution. In the $beat_models run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">plot</span> <span class="n">FullMT</span> <span class="n">waveform_fits</span>
</pre></div>
</div>
<p>If it worked it will produce a pdf with several pages output for all the components for each station that have been used in the optimization.
The black waveforms are the unfiltered data. Red are the best fitting synthetic traces. Light grey and light red are the filtered, untapered
data and synthetic traces respectively. The red data trace below are the residual traces between data and synthetics.
The Z-components from our stations should look something like this.</p>
<blockquote>
<div><img alt="_images/FullMT_waveforms_max.png" src="_images/FullMT_waveforms_max.png" />
</div></blockquote>
<p>The following command produces a ‘.png’ file with the final posterior distribution. In the $beat_models run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">plot</span> <span class="n">FullMT</span> <span class="n">stage_posteriors</span> <span class="o">--</span><span class="n">reference</span> <span class="o">--</span><span class="n">stage_number</span><span class="o">=-</span><span class="mi">2</span> <span class="o">--</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span>
</pre></div>
</div>
<p>It may look like this.</p>
<blockquote>
<div><img alt="_images/FullMT_stage_-2_max.png" src="_images/FullMT_stage_-2_max.png" />
<p>The vertical black lines are the true values and the vertical red lines are the maximum likelihood values.
We see that the true solution is not comprised within the posterior pdfs. This may have several reasons I will not go in to detail for now.</p>
<p>To get an image of parameter correlations (including the true reference value in red) of moment tensor components, the location and the magnitude. In the $beat_models run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">beat</span> <span class="n">plot</span> <span class="n">FullMT</span> <span class="n">correlation_hist</span> <span class="o">--</span><span class="n">reference</span> <span class="o">--</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span> <span class="o">--</span><span class="n">stage_number</span><span class="o">=-</span><span class="mi">2</span> <span class="o">--</span><span class="n">varnames</span><span class="o">=</span><span class="s1">&#39;mee, med, mdd, mnn, mnd, mne, north_shift, east_shift, magnitude&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>This will show an image like that.</p>
<blockquote>
<div><img alt="_images/FullMT_corr_hist_max.png" src="_images/FullMT_corr_hist_max.png" />
</div></blockquote>
<p>This shows 2d kernel density estimates (kde) and histograms of the specified model parameters. The darker the 2d kde the higher the probability of the model parameter.
THe red dot and the vertical red lines show the true values of the target source in the kde plots and histograms, respectively.</p>
<p>The ‘varnames’ option may take any parameter that has been optimized for. For example one might als want to try –varnames=’duration, time, magnitude, north_shift, east_shift’</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
    <a id="sidebar-anchor"></a>
    
<h3><a href="index.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="short_installation.html">Short Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Detailed Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="updating.html">Updating beat</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started with BEAT</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Scenarios</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#regional-full-moment-tensor">Regional Full Moment Tensor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clone-project">Clone project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#calculate-greens-functions">Calculate Greens Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample-the-solution-space">Sample the solution space</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restarting-sampling">Restarting sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#summarize-the-results">Summarize the results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plotting">Plotting</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
    &nbsp;
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="api.html" title="API Reference"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getting_started.html" title="Getting started with BEAT"
             accesskey="P">previous</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Hannes Vasyura-Bathke.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.6.
    </div>
  </body>
</html>